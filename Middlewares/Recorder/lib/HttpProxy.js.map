{"version":3,"sources":["../src/HttpProxy.js"],"names":["tt","HttpProxy","createNewReq","httpclient","createJsonClient","url","process","env","SERVICE_BASE_URL","version","defaultPath","SERVICE_DEFAULT_PATH","defaultMethod","SERVICE_DEFAULT_METHOD","req","Object","assign","method","params","headers","ops","push","http","callback","m","bind","err","res","obj","console","log","results","forEach","resp","index","status","data","body","error"],"mappings":"AAAA;;;;;;;;AAEA;;;;;;;;AAEA,IAAMA,KAAK;AACP,WAAO,EADA;AAEP,kBAAc;AAFP,CAAX;;IAKMC,S;AACF,yBAAa;AAAA;;AACT,aAAKC,YAAL;AACA,aAAKC,UAAL,GAAkB,kBAAQC,gBAAR,CAAyB;AACvCC,iBAAKC,QAAQC,GAAR,CAAYC,gBAAZ,IAAgC,+BADE;AAEvCC,qBAAS;AAF8B,SAAzB,CAAlB;AAIA,aAAKC,WAAL,GAAmBJ,QAAQC,GAAR,CAAYI,oBAAZ,IAAoC,eAAvD;AACA,aAAKC,aAAL,GAAqBN,QAAQC,GAAR,CAAYM,sBAAZ,IAAsC,MAA3D;AACH;;;;uCAEa;AACV,iBAAKC,GAAL,GAAWC,OAAOC,MAAP,CAAc,EAAd,EAAkBhB,EAAlB,CAAX;AACH;;;6BAEIiB,M,EAAQZ,G,EAA2B;AAAA,gBAAtBa,MAAsB,yDAAf,EAAe;AAAA,gBAAXC,OAAW,yDAAH,EAAG;;AACpC,iBAAKL,GAAL,CAASM,GAAT,CAAaC,IAAb,CAAkB;AACdJ,wBAAQA,MADM;AAEdZ,qBAAKA,GAFS;AAGda,wBAAQA,MAHM;AAIdC,yBAASA;AAJK,aAAlB;AAMH;;;4BAEGd,G,EAA2B;AAAA,gBAAtBa,MAAsB,yDAAf,EAAe;AAAA,gBAAXC,OAAW,yDAAH,EAAG;;AAC3B,iBAAKG,IAAL,CAAU,KAAV,EAAiBjB,GAAjB,EAAsBa,MAAtB,EAA8BC,OAA9B;AACH;;;6BAEId,G,EAA2B;AAAA,gBAAtBa,MAAsB,yDAAf,EAAe;AAAA,gBAAXC,OAAW,yDAAH,EAAG;;AAC5B,iBAAKG,IAAL,CAAU,MAAV,EAAkBjB,GAAlB,EAAuBa,MAAvB,EAA+BC,OAA/B;AACH;;;4BAEGd,G,EAA2B;AAAA,gBAAtBa,MAAsB,yDAAf,EAAe;AAAA,gBAAXC,OAAW,yDAAH,EAAG;;AAC3B,iBAAKG,IAAL,CAAU,KAAV,EAAiBjB,GAAjB,EAAsBa,MAAtB,EAA8BC,OAA9B;AACH;;;8BAEKd,G,EAA2B;AAAA,gBAAtBa,MAAsB,yDAAf,EAAe;AAAA,gBAAXC,OAAW,yDAAH,EAAG;;AAC7B,iBAAKG,IAAL,CAAU,OAAV,EAAmBjB,GAAnB,EAAwBa,MAAxB,EAAgCC,OAAhC;AACH;;;gCAEMd,G,EAA2B;AAAA,gBAAtBa,MAAsB,yDAAf,EAAe;AAAA,gBAAXC,OAAW,yDAAH,EAAG;;AAC9B,iBAAKG,IAAL,CAAU,QAAV,EAAoBjB,GAApB,EAAyBa,MAAzB,EAAiCC,OAAjC;AACH;;;8BAEKI,Q,EAAS;AACX,gBAAIT,MAAM,KAAKA,GAAf;AACA,iBAAKZ,YAAL;AACA,gBAAIsB,IAAI,KAAKrB,UAAL,CAAgB,KAAKS,aAArB,CAAR;AACA,gBAAG,OAAOY,CAAP,IAAY,UAAf,EAA0B;AACtBA,oBAAIA,EAAEC,IAAF,CAAO,KAAKtB,UAAZ,CAAJ;AACAqB,kBAAE,KAAKd,WAAP,EAAoBI,GAApB,EAAyB,UAASY,GAAT,EAAcZ,GAAd,EAAmBa,GAAnB,EAAwBC,GAAxB,EAA4B;AACjD,wBAAGF,GAAH,EAAO;AACHG,gCAAQC,GAAR,CAAYJ,GAAZ;AACH,qBAFD,MAEO;AACH,4BAAIK,UAAUH,IAAIG,OAAlB;AACAA,gCAAQC,OAAR,CAAgB,UAASC,IAAT,EAAeC,KAAf,EAAqB;AACjC,gCAAIC,SAASF,KAAKE,MAAlB;AACA,gCAAIC,OAAOH,KAAKI,IAAhB;AACA,gCAAIX,MAAMU,KAAKE,KAAf;AACAf,qCAASG,GAAT,EAAcU,IAAd,EAAoBH,IAApB;AACH,yBALD;AAMH;AACD;AACH,iBAbD;AAcH,aAhBD,MAgBO;AACH,sBAAM,gEAAN;AACH;AACJ;;;;;;kBAGU,IAAIhC,SAAJ,E","file":"HttpProxy.js","sourcesContent":["\"use strict\";\r\n\r\nimport restify from 'restify';\r\n\r\nconst tt = {\r\n    \"ops\": [],\r\n    \"sequential\": true\r\n}\r\n\r\nclass HttpProxy{\r\n    constructor(){\r\n        this.createNewReq();\r\n        this.httpclient = restify.createJsonClient({\r\n            url: process.env.SERVICE_BASE_URL || 'https://example.instflow.com/',\r\n            version: '*'\r\n        });\r\n        this.defaultPath = process.env.SERVICE_DEFAULT_PATH || '/api/v1/batch';\r\n        this.defaultMethod = process.env.SERVICE_DEFAULT_METHOD || 'post';\r\n    }\r\n\r\n    createNewReq(){\r\n        this.req = Object.assign({}, tt);\r\n    }\r\n\r\n    http(method, url, params={}, headers={}){\r\n        this.req.ops.push({\r\n            method: method,\r\n            url: url,\r\n            params: params,\r\n            headers: headers\r\n        });\r\n    }\r\n\r\n    get(url, params={}, headers={}){\r\n        this.http('get', url, params, headers);\r\n    }\r\n\r\n    post(url, params={}, headers={}){\r\n        this.http('post', url, params, headers);\r\n    }\r\n\r\n    put(url, params={}, headers={}){\r\n        this.http('put', url, params, headers);\r\n    }\r\n\r\n    patch(url, params={}, headers={}){\r\n        this.http('patch', url, params, headers);\r\n    }\r\n\r\n    delete(url, params={}, headers={}){\r\n        this.http('delete', url, params, headers);\r\n    }\r\n\r\n    flush(callback){\r\n        let req = this.req;\r\n        this.createNewReq();\r\n        var m = this.httpclient[this.defaultMethod];\r\n        if(typeof m == 'function'){\r\n            m = m.bind(this.httpclient);\r\n            m(this.defaultPath, req, function(err, req, res, obj){\r\n                if(err){\r\n                    console.log(err);\r\n                } else {\r\n                    let results = obj.results;\r\n                    results.forEach(function(resp, index){\r\n                        let status = resp.status;\r\n                        let data = resp.body;\r\n                        let err = data.error;\r\n                        callback(err, data, resp);\r\n                    });\r\n                }\r\n                // Ignore response\r\n            });\r\n        } else {\r\n            throw \"Invalid HTTP verb, must be one of: get, post, put, patch, del.\";\r\n        }\r\n    }\r\n}\r\n\r\nexport default new HttpProxy();"]}