{"version":3,"sources":["../src/DataAcquire.js"],"names":["ORIENTATION_INCOMING","ORIENTATION_OUTGOING","AcquireUser","event","serviceUrl","address","bot_client_id","bot","id","bot_client_name","name","user_client_id","user","user_client_name","channel_id","channelId","extra","undefined","JSON","stringify","saveUser","AcquireMessage","orientation","msg_id","v1","msg_type","type","text","source","agent","conversation_id","conversation","time","Date","getTime","saveMessage","module","exports","receive","next","send"],"mappings":"AAAA;;AAEA;;AACA;;;;AAEA;;;;;;AAEA,IAAMA,uBAAuB,CAA7B;AACA,IAAMC,uBAAuB,CAA7B;;AAGA,SAASC,WAAT,CAAqBC,KAArB,EAA4B;AACxB,QAAIC,aAAaD,MAAME,OAAN,CAAcD,UAA/B;AACA,QAAIE,gBAAgBH,MAAME,OAAN,CAAcE,GAAd,CAAkBC,EAAtC;AACA,QAAIC,kBAAkBN,MAAME,OAAN,CAAcE,GAAd,CAAkBG,IAAxC;AACA,QAAIC,iBAAiBR,MAAME,OAAN,CAAcO,IAAd,CAAmBJ,EAAxC;AACA,QAAIK,mBAAmBV,MAAME,OAAN,CAAcO,IAAd,CAAmBF,IAA1C;AACA,QAAII,aAAaX,MAAME,OAAN,CAAcU,SAA/B;AACA,QAAIC,QAAQ,IAAZ;AACA,QAAIb,MAAME,OAAN,IAAiBY,SAArB,EAAgC;AAC5BD,gBAAQE,KAAKC,SAAL,CAAehB,MAAME,OAArB,CAAR;AACH;AACD,uBAASe,QAAT,CACIhB,UADJ,EACgBE,aADhB,EAC+BG,eAD/B,EAEIE,cAFJ,EAEoBE,gBAFpB,EAEsCC,UAFtC,EAEkDE,KAFlD;AAIH;;AAED,SAASK,cAAT,CAAwBlB,KAAxB,EAA+BmB,WAA/B,EAA4C;AACxC,QAAIC,SAAS,mBAAKC,EAAL,EAAb;AACA,QAAIC,WAAWtB,MAAMuB,IAArB;AACA,QAAIC,OAAOxB,MAAMwB,IAAjB;AACA,QAAIC,SAASzB,MAAMyB,MAAnB;AACA,QAAIC,QAAQ1B,MAAM0B,KAAlB;AACA,QAAIzB,aAAaD,MAAME,OAAN,CAAcD,UAA/B;AACA,QAAIO,iBAAiBR,MAAME,OAAN,CAAcO,IAAd,CAAmBJ,EAAxC;AACA,QAAIK,mBAAmBV,MAAME,OAAN,CAAcO,IAAd,CAAmBF,IAA1C;AACA,QAAIJ,gBAAgBH,MAAME,OAAN,CAAcE,GAAd,CAAkBC,EAAtC;AACA,QAAIC,kBAAkBN,MAAME,OAAN,CAAcE,GAAd,CAAkBG,IAAxC;AACA,QAAII,aAAaX,MAAME,OAAN,CAAcU,SAA/B;AACA,QAAIe,kBAAkB3B,MAAME,OAAN,CAAc0B,YAAd,CAA2BvB,EAAjD;AACA,QAAIwB,OAAO,IAAIC,IAAJ,GAAWC,OAAX,EAAX;AACA,uBAASC,WAAT,CACIZ,MADJ,EACYE,QADZ,EACsBE,IADtB,EAC4BC,MAD5B,EACoCC,KADpC,EAC2CzB,UAD3C,EACuDO,cADvD,EAEIE,gBAFJ,EAEsBP,aAFtB,EAEqCG,eAFrC,EAEsDK,UAFtD,EAEkEgB,eAFlE,EAGIR,WAHJ,EAGiBU,IAHjB;AAKH;;AAEDI,OAAOC,OAAP,GAAiB,YAAY;AACzB,WAAO;AACHC,iBAAS,iBAAUnC,KAAV,EAAiBoC,IAAjB,EAAuB;AAC5BrC,wBAAYC,KAAZ;AACAkB,2BAAelB,KAAf,EAAsBH,oBAAtB;AACAuC;AACH,SALE;AAMHC,cAAM,cAAUrC,KAAV,EAAiBoC,IAAjB,EAAuB;AACzBlB,2BAAelB,KAAf,EAAsBF,oBAAtB;AACAsC;AACH;AATE,KAAP;AAWH,CAZD","file":"DataAcquire.js","sourcesContent":["\"use strict\";\r\n\r\nimport \"babel-polyfill\";\r\nimport uuid from 'node-uuid';\r\n\r\nimport schedule from './Schedule';\r\n\r\nconst ORIENTATION_INCOMING = 1;\r\nconst ORIENTATION_OUTGOING = 2;\r\n\r\n\r\nfunction AcquireUser(event) {\r\n    let serviceUrl = event.address.serviceUrl;\r\n    let bot_client_id = event.address.bot.id;\r\n    let bot_client_name = event.address.bot.name;\r\n    let user_client_id = event.address.user.id;\r\n    let user_client_name = event.address.user.name;\r\n    let channel_id = event.address.channelId;\r\n    let extra = null;\r\n    if (event.address != undefined) {\r\n        extra = JSON.stringify(event.address);\r\n    }\r\n    schedule.saveUser(\r\n        serviceUrl, bot_client_id, bot_client_name, \r\n        user_client_id, user_client_name, channel_id, extra\r\n    );\r\n}\r\n\r\nfunction AcquireMessage(event, orientation) {\r\n    let msg_id = uuid.v1();\r\n    let msg_type = event.type;\r\n    let text = event.text;\r\n    let source = event.source;\r\n    let agent = event.agent;\r\n    let serviceUrl = event.address.serviceUrl;\r\n    let user_client_id = event.address.user.id;\r\n    let user_client_name = event.address.user.name;\r\n    let bot_client_id = event.address.bot.id;\r\n    let bot_client_name = event.address.bot.name;\r\n    let channel_id = event.address.channelId;\r\n    let conversation_id = event.address.conversation.id;\r\n    let time = new Date().getTime();\r\n    schedule.saveMessage(\r\n        msg_id, msg_type, text, source, agent, serviceUrl, user_client_id, \r\n        user_client_name, bot_client_id, bot_client_name, channel_id, conversation_id, \r\n        orientation, time\r\n    );\r\n}\r\n\r\nmodule.exports = function () {\r\n    return {\r\n        receive: function (event, next) {\r\n            AcquireUser(event);\r\n            AcquireMessage(event, ORIENTATION_INCOMING);\r\n            next();\r\n        },\r\n        send: function (event, next) {\r\n            AcquireMessage(event, ORIENTATION_OUTGOING);\r\n            next();\r\n        }\r\n    }\r\n};\r\n"]}